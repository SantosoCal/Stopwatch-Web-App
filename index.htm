<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    </head>
    <body>
        <h1 align="center">Stopwatch</h1>
        <p align="center">By Andrew Santoso</p>
        <div id="time" style="text-align: center;margin-bottom: 10px; font-size: 400%">00:00:00.000</div>
        <div style="text-align: center;">
            <button id="startBtn" class="btn btn-primary">Start the clock</button>
            <button id="stopBtn" class="btn btn-danger" disabled="true">Stop the clock</button>
            <button id="resetBtn" class="btn btn-danger">Reset</button>
        </div> 
        <div class="container">
            <h2>Times</h2>
            <h4 id="errorMsg"></h4>            
            <table class="table table-hover" id="timeTable">
                <thead>
                    <tr>
                        <th>Entry</th>
                        <th>Time</th>
                        <th>Time Elapsed</th>
                        <th>Timezone</th>
                        <th>Latitude</th>
                        <th>Longitude</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>


        <script>
            window.onload = function() {
                startBtn = document.getElementById("startBtn");
                stopBtn = document.getElementById("stopBtn");
                resetBtn = document.getElementById("resetBtn");
                stopWatch();
                geoFindMe();
            }
        </script>

        <script>

            var timeBegan = null
            , timeStopped = null
            , stoppedDuration = 0
            , started = null
            , lapCount = 1
            , hitStart = false;

            var currentTime;
            var timeElapsed;
            var elapsedHour;
            var elapsedMin;
            var elapsedSec;
            var elapsedMs;

            let startBtn;
            let stopBtn;
            let resetBtn;

            function stopWatch() {

                startBtn.addEventListener("click", function () {
                    startBtn.disabled = true;
                    stopBtn.disabled = false;
                    if (timeBegan === null) {
                        timeBegan = new Date();
                    }
                    started = setInterval(clockRunning, 10);
                    hitStart = true;
                });

                stopBtn.addEventListener("click", function () {
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                    geoFindMe();
                });

                resetBtn.addEventListener("click", function () {
                    clearInterval(started);
                    stoppedDuration = 0;
                    timeBegan = null;
                    timeStopped = null;
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                    document.getElementById("time").innerHTML = "00:00:00.000";
                });

                function clockRunning(){
                    currentTime = new Date();
                    timeElapsed = new Date(currentTime - timeBegan - stoppedDuration);
                    elapsedHour = timeElapsed.getUTCHours();
                    elapsedMin = timeElapsed.getUTCMinutes();
                    elapsedSec = timeElapsed.getUTCSeconds();
                    elapsedMs = timeElapsed.getUTCMilliseconds();
                    document.getElementById("time").innerHTML = getTimeElapsed();
                };

            }

            function getTimeElapsed() {
                return (elapsedHour > 9 ? elapsedHour : "0" + elapsedHour) + ":" + 
                    (elapsedMin > 9 ? elapsedMin : "0" + elapsedMin) + ":" + 
                    (elapsedSec > 9 ? elapsedSec : "0" + elapsedSec) + "." + 
                    (elapsedMs > 99 ? elapsedMs : elapsedMs > 9 ? "0" + elapsedMs : "00" + elapsedMs);
            }

            function getCurrentTime() {
                var d = new Date();
                var hour = d.getHours();
                var min = d.getMinutes();
                var sec = d.getSeconds();
                return hour + ":" + (min > 9 ? min : "0" + min) + ":" + (sec > 9 ? sec : "0" + sec);
            }

            function geoFindMe() {

                var errorMsg = document.getElementById("errorMsg");

                if (!navigator.geolocation){
                    errMsg.innerHTML = "<h4>Geolocation is not supported by your browser</h4>";
                    return;
                }

                function success(position) {
                    if (hitStart === true) {
                        latitude  = position.coords.latitude;
                        longitude = position.coords.longitude;
                        var row = $("<tr><td>" + lapCount +
                                    "</td><td>" + getCurrentTime() +  
                                    "</td><td>" + getTimeElapsed() + 
                                    "</td><td>" + Intl.DateTimeFormat().resolvedOptions().timeZone + 
                                    "</td><td>" + latitude + 
                                    "</td><td>" + longitude + 
                                    "</td></tr>");
                        $("#timeTable > tbody").append(row);
                        timeStopped = new Date();
                        clearInterval(started);
                        lapCount ++;
                    }
                }

                function error() {
                    errMsg.innerHTML = "Unable to retrieve your location";
                }

                navigator.geolocation.getCurrentPosition(success, error);
            }

        </script>

    </body>
</html>